<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Online - Joyas, Vestimenta y Perfumes</title>
    
    <!-- Firebase 8.10.1 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- Cloudinary Upload Widget -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header y Navegaci√≥n */
        .main-header {
            background: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            font-weight: 800;
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .navbar-cart {
            position: relative;
            cursor: pointer;
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--warning-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1) 0%, rgba(114, 9, 183, 0.05) 100%);
            padding: 80px 0;
            margin-bottom: 50px;
        }
        
        /* Categor√≠as */
        .category-card {
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            height: 100%;
            cursor: pointer;
        }
        
        .category-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .category-jewels {
            background: linear-gradient(135deg, #ff9a00, #ff5e00);
            color: white;
        }
        
        .category-clothing {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }
        
        .category-perfumes {
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            color: white;
        }
        
        .category-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
        }
        
        /* Productos */
        .product-card {
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            height: 100%;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .product-img {
            height: 220px;
            object-fit: cover;
            width: 100%;
        }
        
        .product-price {
            font-weight: 700;
            color: var(--accent-color);
            font-size: 1.4rem;
        }
        
        .sale-price {
            color: var(--warning-color);
        }
        
        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9rem;
        }
        
        .badge-sale {
            background-color: var(--warning-color);
            color: white;
        }
        
        .badge-new {
            background-color: var(--success-color);
            color: white;
        }
        
        /* Carrito de compras */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -450px;
            width: 400px;
            height: 100vh;
            background-color: white;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.1);
            z-index: 1050;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .cart-sidebar.open {
            right: 0;
        }
        
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            display: none;
        }
        
        .cart-overlay.show {
            display: block;
        }
        
        .cart-item-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        /* Checkout y Login */
        .checkout-container, .login-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--secondary-color);
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .payment-option {
            border: 2px solid #e1e5eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-option:hover, .payment-option.active {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .upload-receipt {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background-color: #f8f9fa;
            cursor: pointer;
        }
        
        .upload-receipt:hover {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        /* Footer */
        .main-footer {
            background-color: #222;
            color: white;
            padding: 50px 0 20px;
            margin-top: auto;
        }
        
        /* Alertas y mensajes */
        .status-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            border: none;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99999;
        }
        
        /* Auth Errors */
        .auth-error {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        /* Modal de autenticaci√≥n mejorado */
        .auth-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
        }
        
        .auth-modal .modal-header {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: none;
        }
        
        .auth-modal .modal-body {
            padding: 2rem;
        }
        
        /* Panel de Administraci√≥n */
        .admin-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 30px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .stats-card {
            border-radius: 10px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
        }
        
        .stats-total {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
        }
        
        .stats-pending {
            background: linear-gradient(135deg, #ff9a00, #ff5e00);
        }
        
        .stats-completed {
            background: linear-gradient(135deg, #00b09b, #96c93d);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .hero-section {
                padding: 40px 0;
            }
            
            .product-img {
                height: 180px;
            }
            
            .auth-modal .modal-body {
                padding: 1.5rem;
            }
            
            .admin-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="text-center">
            <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <h5 class="mt-3" id="loadingText">Procesando...</h5>
        </div>
    </div>

    <!-- Status Alert -->
    <div id="statusAlert" class="alert alert-dismissible fade show status-alert" style="display: none;" role="alert">
        <span id="statusMessage"></span>
        <button type="button" class="btn-close" onclick="hideStatus()"></button>
    </div>

    <!-- Overlay para el carrito -->
    <div id="cartOverlay" class="cart-overlay" onclick="closeCart()"></div>

    <!-- Carrito de compras -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Carrito</h4>
                <button type="button" class="btn-close" onclick="closeCart()"></button>
            </div>
            
            <div id="cartItemsContainer">
                <div id="emptyCartMessage" class="text-center py-5">
                    <i class="fas fa-shopping-cart fa-4x mb-4 text-muted"></i>
                    <h5 class="text-muted">Tu carrito est√° vac√≠o</h5>
                    <p class="text-muted">Agrega productos para comenzar a comprar</p>
                </div>
            </div>
            
            <div id="cartSummary" style="display: none;">
                <hr>
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <span id="cartSubtotal">$0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <span>Env√≠o:</span>
                    <span id="cartShipping">$0.00</span>
                </div>
                <div class="d-flex justify-content-between fw-bold fs-5 mb-4">
                    <span>Total:</span>
                    <span id="cartTotal">$0.00</span>
                </div>
                
                <button class="btn btn-primary w-100 mb-3" onclick="goToCheckout()">
                    <i class="fas fa-check-circle me-2"></i> Proceder al Pago
                </button>
                <button class="btn btn-outline-secondary w-100" onclick="closeCart()">
                    Seguir Comprando
                </button>
            </div>
        </div>
    </div>

    <!-- Header Principal -->
    <header class="main-header" id="mainHeader">
        <nav class="navbar navbar-expand-lg navbar-light py-3">
            <div class="container">
                <a class="navbar-brand logo" href="#" onclick="showHome()">
                    <i class="fas fa-gem me-2"></i>LuxuryShop
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showCategory('all')">Inicio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showCategory('Joyas')">Joyas</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showCategory('Vestimenta')">Vestimenta</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showCategory('Perfumes')">Perfumes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showCategory('Accesorios')">Accesorios</a>
                        </li>
                    </ul>
                    
                    <div class="d-flex align-items-center">
                        <div class="navbar-cart me-4" onclick="toggleCart()">
                            <i class="fas fa-shopping-cart fa-lg"></i>
                            <span id="cartCount" class="cart-count">0</span>
                        </div>
                        
                        <div id="userAuthSection">
                            <button class="btn btn-outline-primary" id="loginBtn" onclick="showLoginModal()">
                                <i class="fas fa-user me-1"></i> Iniciar Sesi√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Contenido Principal (Tienda) -->
    <div id="mainContent">
        <!-- Secci√≥n Hero -->
        <section class="hero-section">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <h1 class="display-4 fw-bold mb-4">Descubre productos exclusivos</h1>
                        <p class="lead mb-4">Joyas √∫nicas, vestimenta elegante y perfumes sofisticados. Todo en un solo lugar.</p>
                        <button class="btn btn-primary btn-lg" onclick="showCategory('all')">
                            <i class="fas fa-shopping-bag me-2"></i> Comprar Ahora
                        </button>
                    </div>
                    <div class="col-lg-6">
                        <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner rounded-3 overflow-hidden">
                                <div class="carousel-item active">
                                    <img src="https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                                         class="d-block w-100" alt="Joyas" style="height: 350px; object-fit: cover;">
                                </div>
                                <div class="carousel-item">
                                    <img src="https://i.ibb.co/7dnZp99g/Joyas.png" 
                                         class="d-block w-100" alt="Vestimenta" style="height: 350px; object-fit: cover;">
                                </div>
                                <div class="carousel-item">
                                    <img src="https://images.unsplash.com/photo-1541643600914-78b084683601?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                                         class="d-block w-100" alt="Perfumes" style="height: 350px; object-fit: cover;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Categor√≠as -->
        <section class="container mb-5">
            <h2 class="section-title text-center mb-5">Nuestras Categor√≠as</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="category-card category-jewels text-center p-5" onclick="showCategory('Joyas')">
                        <i class="fas fa-gem category-icon"></i>
                        <h3>Joyas</h3>
                        <p>Collares, anillos, pulseras y m√°s</p>
                        <div class="mt-3" id="jewelsCountBadge">
                            <span class="badge bg-light text-dark">0 productos</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="category-card category-clothing text-center p-5" onclick="showCategory('Vestimenta')">
                        <i class="fas fa-tshirt category-icon"></i>
                        <h3>Vestimenta</h3>
                        <p>Ropa elegante y accesorios</p>
                        <div class="mt-3" id="clothingCountBadge">
                            <span class="badge bg-light text-dark">0 productos</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="category-card category-perfumes text-center p-5" onclick="showCategory('Perfumes')">
                        <i class="fas fa-spray-can category-icon"></i>
                        <h3>Perfumes</h3>
                        <p>Fragancias √∫nicas para cada ocasi√≥n</p>
                        <div class="mt-3" id="perfumesCountBadge">
                            <span class="badge bg-light text-dark">0 productos</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Productos -->
        <section class="container mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="section-title" id="productsSectionTitle">Productos Destacados</h2>
                <div class="d-flex">
                    <select id="sortProducts" class="form-select me-2" style="max-width: 200px;" onchange="filterProducts()">
                        <option value="newest">M√°s recientes</option>
                        <option value="price_asc">Precio: Menor a Mayor</option>
                        <option value="price_desc">Precio: Mayor a Menor</option>
                        <option value="name_asc">Nombre: A-Z</option>
                    </select>
                    <select id="filterByStatus" class="form-select" style="max-width: 200px;" onchange="filterProducts()">
                        <option value="all">Todos los productos</option>
                        <option value="sale">En oferta</option>
                        <option value="new">Nuevos</option>
                    </select>
                </div>
            </div>
            
            <div id="productsContainer" class="row">
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando productos...</span>
                    </div>
                    <p class="mt-3">Cargando productos...</p>
                </div>
            </div>
            
            <div id="noProductsMessage" class="text-center py-5" style="display: none;">
                <i class="fas fa-box-open fa-4x mb-4 text-muted"></i>
                <h4 class="text-muted">No hay productos en esta categor√≠a</h4>
                <p class="text-muted">Prueba con otra categor√≠a o vuelve m√°s tarde.</p>
            </div>
        </section>
    </div>

    <!-- P√°gina de Checkout -->
    <div id="checkoutPage" class="checkout-container" style="display: none;">
        <h2 class="section-title">Finalizar Compra</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Resumen del Pedido</h5>
                    </div>
                    <div class="card-body">
                        <div id="checkoutItems"></div>
                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span id="checkoutSubtotal">$0.00</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span>Env√≠o:</span>
                            <span id="checkoutShipping">$5.00</span>
                        </div>
                        <div class="d-flex justify-content-between fw-bold fs-5">
                            <span>Total:</span>
                            <span id="checkoutTotal">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Informaci√≥n de Pago</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h6>M√©todo de Pago</h6>
                            <div class="payment-option active" onclick="selectPayment('transfer')">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="transferPayment" checked>
                                    <label class="form-check-label fw-bold" for="transferPayment">
                                        Transferencia Bancaria
                                    </label>
                                </div>
                                <p class="mb-0 mt-2 text-muted small">Realiza una transferencia a nuestra cuenta bancaria y sube el comprobante.</p>
                            </div>
                        </div>
                        
                        <div id="transferInfo" class="mb-4">
                            <h6>Informaci√≥n Bancaria</h6>
                            <div class="border rounded p-3 bg-light">
                                <p class="mb-1"><strong>Banco:</strong> Banco Nacional</p>
                                <p class="mb-1"><strong>Cuenta:</strong> 123-456789-0</p>
                                <p class="mb-1"><strong>Titular:</strong> LuxuryShop S.A.</p>
                                <p class="mb-0"><strong>CLABE:</strong> 012180012345678900</p>
                            </div>
                            <p class="small text-muted mt-2">Usa tu n√∫mero de pedido como referencia al realizar la transferencia.</p>
                        </div>
                        
                        <div class="mb-4">
                            <h6>Subir Comprobante de Pago</h6>
                            <div class="upload-receipt" onclick="openCloudinaryUpload()" id="uploadReceiptBtn">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <h5>Haz clic para subir comprobante</h5>
                                <p class="text-muted">Formatos: JPG, PNG, PDF (M√°x. 10MB)</p>
                            </div>
                            <div id="receiptPreview" class="mt-3 text-center"></div>
                            <input type="hidden" id="cloudinaryReceiptUrl">
                        </div>
                        
                        <button class="btn btn-primary w-100 btn-lg" onclick="completeOrder()" id="completeOrderBtn">
                            <i class="fas fa-check-circle me-2"></i> Confirmar Pedido
                        </button>
                        <button class="btn btn-outline-secondary w-100 mt-2" onclick="returnToShop()">
                            <i class="fas fa-arrow-left me-2"></i> Volver a la Tienda
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel de Administraci√≥n -->
    <div id="adminPage" class="admin-container" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title">Panel de Administraci√≥n</h2>
            <div>
                <button class="btn btn-outline-secondary me-2" onclick="returnToShop()">
                    <i class="fas fa-store me-1"></i> Volver a la Tienda
                </button>
                <button class="btn btn-primary" onclick="loadAdminOrders()">
                    <i class="fas fa-sync-alt me-1"></i> Actualizar
                </button>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stats-card stats-total">
                    <h5>Total Pedidos</h5>
                    <h2 id="totalOrders">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card stats-pending">
                    <h5>Pedidos Pendientes</h5>
                    <h2 id="pendingOrders">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card stats-completed">
                    <h5>Pedidos Completados</h5>
                    <h2 id="completedOrders">0</h2>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">Filtros</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="statusFilter" onchange="filterAdminOrders()">
                                <option value="all">Todos</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="confirmado">Confirmado</option>
                                <option value="enviado">Enviado</option>
                                <option value="completado">Completado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fecha Desde</label>
                            <input type="date" class="form-control" id="dateFromFilter" onchange="filterAdminOrders()">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fecha Hasta</label>
                            <input type="date" class="form-control" id="dateToFilter" onchange="filterAdminOrders()">
                        </div>
                        <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                            <i class="fas fa-times me-1"></i> Limpiar Filtros
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Pedidos</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Pedido #</th>
                                        <th>Cliente</th>
                                        <th>Fecha</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="adminOrdersTable">
                                    <tr>
                                        <td colspan="6" class="text-center">Cargando pedidos...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer" id="mainFooter">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h4 class="logo mb-3">LuxuryShop</h4>
                    <p>Tu tienda online de confianza para productos exclusivos de alta calidad.</p>
                    <div class="mt-3">
                        <a href="#" class="text-white me-3"><i class="fab fa-facebook fa-lg"></i></a>
                        <a href="#" class="text-white me-3"><i class="fab fa-instagram fa-lg"></i></a>
                        <a href="#" class="text-white"><i class="fab fa-twitter fa-lg"></i></a>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <h5 class="mb-3">Categor√≠as</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white-50 text-decoration-none" onclick="showCategory('Joyas')">Joyas</a></li>
                        <li><a href="#" class="text-white-50 text-decoration-none" onclick="showCategory('Vestimenta')">Vestimenta</a></li>
                        <li><a href="#" class="text-white-50 text-decoration-none" onclick="showCategory('Perfumes')">Perfumes</a></li>
                        <li><a href="#" class="text-white-50 text-decoration-none" onclick="showCategory('Accesorios')">Accesorios</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5 class="mb-3">Contacto</h5>
                    <p class="mb-1"><i class="fas fa-map-marker-alt me-2"></i> Av. Principal 123, Ciudad</p>
                    <p class="mb-1"><i class="fas fa-phone me-2"></i> +1 234 567 890</p>
                    <p class="mb-1"><i class="fas fa-envelope me-2"></i> info@luxuryshop.com</p>
                </div>
            </div>
            <hr class="bg-white-50">
            <div class="text-center pt-3">
                <p class="mb-0">&copy; 2023 LuxuryShop. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Modal de Login/Registro -->
    <div class="modal fade auth-modal" id="authModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalTitle">Iniciar Sesi√≥n</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Correo Electr√≥nico</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                            <div id="loginEmailError" class="auth-error"></div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="loginPassword" class="form-label">Contrase√±a</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                            <div id="loginPasswordError" class="auth-error"></div>
                        </div>
                        
                        <div id="loginGeneralError" class="alert alert-danger" style="display: none;"></div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesi√≥n
                        </button>
                        
                        <div class="text-center">
                            <p class="text-muted">¬øNo tienes cuenta? <a href="#" onclick="showRegisterForm()">Reg√≠strate</a></p>
                        </div>
                    </form>
                    
                    <form id="registerForm" style="display: none;">
                        <div class="mb-3">
                            <label for="registerName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="registerName" required>
                            <div id="registerNameError" class="auth-error"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Correo Electr√≥nico</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                            <div id="registerEmailError" class="auth-error"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Contrase√±a</label>
                            <input type="password" class="form-control" id="registerPassword" required minlength="6">
                            <div id="registerPasswordError" class="auth-error"></div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="registerConfirmPassword" class="form-label">Confirmar Contrase√±a</label>
                            <input type="password" class="form-control" id="registerConfirmPassword" required>
                            <div id="registerConfirmPasswordError" class="auth-error"></div>
                        </div>
                        
                        <div id="registerGeneralError" class="alert alert-danger" style="display: none;"></div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-secondary w-50" onclick="showLoginForm()">
                                <i class="fas fa-arrow-left me-1"></i> Volver
                            </button>
                            <button type="submit" class="btn btn-primary w-50">
                                <i class="fas fa-user-plus me-2"></i> Registrarse
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√≥n de acceso a Admin (solo visible para admin) -->
    <button id="adminAccessBtn" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: none;" 
            class="btn btn-secondary" onclick="showAdminPanel()">
        <i class="fas fa-cog"></i> Admin
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ============================================
        // CONFIGURACI√ìN DE FIREBASE 8.10.1
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyANa6zWkGrYQ7O7M6XT2oYbArsZIcs36M8",
            authDomain: "trip-a9341.firebaseapp.com",
            databaseURL: "https://trip-a9341-default-rtdb.firebaseio.com",
            projectId: "trip-a9341",
            storageBucket: "trip-a9341.appspot.com",
            messagingSenderId: "379336201132",
            appId: "1:379336201132:web:34b0b863c3462c12aba009",
            measurementId: "G-PJQ32ZXJ0B"
        };

        console.log("üöÄ Inicializando Firebase...");
        
        // Inicializar Firebase
        let firebaseApp;
        let firebaseAuth;
        let firebaseDatabase;
        
        try {
            // Inicializar la app de Firebase
            firebaseApp = firebase.initializeApp(firebaseConfig);
            
            // Obtener las referencias a los servicios
            firebaseAuth = firebase.auth();
            firebaseDatabase = firebase.database();
            
            console.log("‚úÖ Firebase 8.10.1 inicializado correctamente");
            
        } catch (error) {
            console.error("‚ùå Error inicializando Firebase 8.10.1:", error);
            showStatus("Error de configuraci√≥n de Firebase: " + error.message, "danger");
        }
        
        // ============================================
        // CONFIGURACI√ìN DE CLOUDINARY CON TUS DATOS
        // ============================================
        const CLOUDINARY_CLOUD_NAME = "djelnkrtm";
        const CLOUDINARY_UPLOAD_PRESET = "Depositos"; // Usando tu preset
        const CLOUDINARY_API_KEY = "898269749111574"; // Tu API Key
        
        // Configuraci√≥n de Cloudinary seg√∫n tus datos
        const cloudinaryConfig = {
            cloudName: CLOUDINARY_CLOUD_NAME,
            uploadPreset: CLOUDINARY_UPLOAD_PRESET,
            apiKey: CLOUDINARY_API_KEY,
            sources: ['local', 'camera', 'url'], // Fuentes de archivos permitidas
            multiple: false, // Solo una imagen a la vez
            maxFileSize: 10485760, // 10MB en bytes
            resourceType: 'auto', // Auto-detecta si es imagen o video
            clientAllowedFormats: ['jpg', 'jpeg', 'png', 'pdf', 'gif', 'bmp'], // Formatos permitidos
            maxImageWidth: 2000, // Ancho m√°ximo
            maxImageHeight: 2000, // Alto m√°ximo
            cropping: false, // No permitir recortar
            showAdvancedOptions: false, // Opciones avanzadas ocultas
            folder: "samples/depositos", // Tu folder especificado
            publicId: "", // Dejar vac√≠o para auto-generar
            tags: ["depositos", "comprobantes", "pagos"], // Tags para organizar
            context: {caption: "Comprobante de pago"}, // Contexto/metadatos
            styles: {
                palette: {
                    window: "#FFFFFF",
                    windowBorder: "#90A0B3",
                    tabIcon: "#0078FF",
                    menuIcons: "#5A616A",
                    textDark: "#000000",
                    textLight: "#FFFFFF",
                    link: "#0078FF",
                    action: "#FF620C",
                    inactiveTabIcon: "#0E2F5A",
                    error: "#F44235",
                    inProgress: "#0078FF",
                    complete: "#20B832",
                    sourceBg: "#E4EBF1"
                },
                fonts: {
                    default: {
                        active: true
                    }
                }
            }
        };
        
        console.log("‚òÅÔ∏è Cloudinary configurado con tus datos:");
        console.log("- Cloud Name:", CLOUDINARY_CLOUD_NAME);
        console.log("- Upload Preset:", CLOUDINARY_UPLOAD_PRESET);
        console.log("- Folder:", "samples/depositos");
        console.log("üìÅ Las im√°genes se guardar√°n en Cloudinary en la carpeta samples/depositos");
        
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let currentUser = null;
        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentCategory = 'all';
        let allOrders = [];
        let currentReceiptUrl = '';
        let cloudinaryWidget = null; // Variable para el widget de Cloudinary
        
        // ============================================
        // INICIALIZACI√ìN DE LA APLICACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ DOM cargado, iniciando aplicaci√≥n...");
            
            // Configurar eventos
            setupEventListeners();
            
            // Inicializar widget de Cloudinary
            initializeCloudinaryWidget();
            
            // Verificar estado de autenticaci√≥n
            if (firebaseAuth) {
                firebaseAuth.onAuthStateChanged(function(user) {
                    console.log("üîê Estado de autenticaci√≥n cambiado:", user ? "Usuario autenticado" : "No autenticado");
                    currentUser = user;
                    updateUserUI();
                    
                    // Mostrar bot√≥n de admin si el usuario es admin
                    if (user && (user.email === 'admin@luxuryshop.com' || user.email === 'admin@admin.com')) {
                        document.getElementById('adminAccessBtn').style.display = 'block';
                    } else {
                        document.getElementById('adminAccessBtn').style.display = 'none';
                    }
                    
                    // Cargar productos
                    loadProducts();
                    
                    // Actualizar carrito
                    updateCartUI();
                    
                    // Si el usuario est√° autenticado, cargar tambi√©n su carrito guardado en Firebase
                    if (user) {
                        loadUserCartFromFirebase();
                    }
                }, function(error) {
                    console.error("‚ùå Error en onAuthStateChanged:", error);
                    showStatus("Error en autenticaci√≥n: " + error.message, "danger");
                });
            }
        });
        
        // ============================================
        // CONFIGURACI√ìN DE EVENTOS
        // ============================================
        function setupEventListeners() {
            console.log("üîß Configurando eventos...");
            
            // Login
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    console.log("üì® Formulario de login enviado");
                    const email = document.getElementById('loginEmail').value;
                    const password = document.getElementById('loginPassword').value;
                    loginUser(email, password);
                });
            }
            
            // Registro
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    console.log("üì® Formulario de registro enviado");
                    const name = document.getElementById('registerName').value;
                    const email = document.getElementById('registerEmail').value;
                    const password = document.getElementById('registerPassword').value;
                    const confirmPassword = document.getElementById('registerConfirmPassword').value;
                    
                    // Validaciones
                    clearAuthErrors();
                    
                    let hasError = false;
                    
                    if (!name || name.trim().length < 2) {
                        showAuthError('registerNameError', 'El nombre debe tener al menos 2 caracteres');
                        hasError = true;
                    }
                    
                    if (!isValidEmail(email)) {
                        showAuthError('registerEmailError', 'Ingresa un correo electr√≥nico v√°lido');
                        hasError = true;
                    }
                    
                    if (password.length < 6) {
                        showAuthError('registerPasswordError', 'La contrase√±a debe tener al menos 6 caracteres');
                        hasError = true;
                    }
                    
                    if (password !== confirmPassword) {
                        showAuthError('registerConfirmPasswordError', 'Las contrase√±as no coinciden');
                        hasError = true;
                    }
                    
                    if (hasError) return;
                    
                    registerUser(name, email, password);
                });
            }
        }
        
        // ============================================
        // INICIALIZACI√ìN DE CLOUDINARY WIDGET
        // ============================================
        function initializeCloudinaryWidget() {
            console.log("‚òÅÔ∏è Inicializando widget de Cloudinary...");
            
            try {
                // Crear el widget de Cloudinary con la configuraci√≥n
                cloudinaryWidget = cloudinary.createUploadWidget(
                    cloudinaryConfig,
                    function(error, result) {
                        console.log("üì§ Resultado de Cloudinary:", result);
                        
                        if (error) {
                            console.error("‚ùå Error en Cloudinary Widget:", error);
                            showStatus('Error al subir el comprobante: ' + error.message, 'danger');
                            return;
                        }
                        
                        if (result && result.event === "success") {
                            console.log("‚úÖ Subida exitosa a Cloudinary");
                            console.log("üìÑ Informaci√≥n del archivo:", result.info);
                            
                            // Obtener la URL de la imagen
                            const imageUrl = result.info.secure_url;
                            currentReceiptUrl = imageUrl;
                            document.getElementById('cloudinaryReceiptUrl').value = imageUrl;
                            
                            // Mostrar previsualizaci√≥n
                            const preview = document.getElementById('receiptPreview');
                            if (result.info.resource_type === 'image') {
                                preview.innerHTML = `
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i> Comprobante subido exitosamente
                                    </div>
                                    <img src="${imageUrl}" class="img-fluid rounded mt-2" style="max-height: 150px;" alt="Comprobante">
                                    <p class="mt-2 small">
                                        <strong>Archivo:</strong> ${result.info.original_filename}<br>
                                        <strong>Tama√±o:</strong> ${formatBytes(result.info.bytes)}<br>
                                        <strong>Formato:</strong> ${result.info.format.toUpperCase()}
                                    </p>
                                    <button class="btn btn-sm btn-outline-danger" onclick="removeReceipt()">
                                        <i class="fas fa-trash me-1"></i> Eliminar
                                    </button>
                                `;
                            } else if (result.info.resource_type === 'raw' && result.info.format === 'pdf') {
                                preview.innerHTML = `
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i> PDF subido exitosamente
                                    </div>
                                    <div class="p-3 border rounded bg-light mt-2">
                                        <i class="fas fa-file-pdf fa-3x text-danger mb-2"></i>
                                        <p class="mb-1"><strong>Archivo:</strong> ${result.info.original_filename}</p>
                                        <p class="mb-1"><strong>Tama√±o:</strong> ${formatBytes(result.info.bytes)}</p>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger mt-2" onclick="removeReceipt()">
                                        <i class="fas fa-trash me-1"></i> Eliminar
                                    </button>
                                `;
                            } else {
                                preview.innerHTML = `
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i> Archivo subido exitosamente
                                    </div>
                                    <p class="mt-2 small">
                                        <strong>Archivo:</strong> ${result.info.original_filename}<br>
                                        <strong>Tama√±o:</strong> ${formatBytes(result.info.bytes)}<br>
                                        <strong>Formato:</strong> ${result.info.format.toUpperCase()}
                                    </p>
                                    <button class="btn btn-sm btn-outline-danger" onclick="removeReceipt()">
                                        <i class="fas fa-trash me-1"></i> Eliminar
                                    </button>
                                `;
                            }
                            
                            showStatus('‚úÖ Comprobante subido correctamente a Cloudinary', 'success');
                        } else if (result && result.event === "close") {
                            console.log("‚ÑπÔ∏è Widget de Cloudinary cerrado");
                        } else if (result && result.event === "queues-start") {
                            console.log("‚è≥ Iniciando subida...");
                            showStatus('Subiendo comprobante...', 'info');
                        } else if (result && result.event === "queues-end") {
                            console.log("‚úÖ Proceso de subida completado");
                        }
                    }
                );
                
                console.log("‚úÖ Widget de Cloudinary inicializado correctamente");
            } catch (error) {
                console.error("‚ùå Error inicializando Cloudinary Widget:", error);
                showStatus("Error configurando Cloudinary: " + error.message, "danger");
            }
        }
        
        // ============================================
        // FUNCI√ìN PARA ABRIR CLOUDINARY UPLOAD
        // ============================================
        function openCloudinaryUpload() {
            console.log("‚òÅÔ∏è Abriendo widget de Cloudinary...");
            
            if (!cloudinaryWidget) {
                console.error("‚ùå Widget de Cloudinary no inicializado");
                showStatus("Error: Widget de Cloudinary no est√° disponible", "danger");
                return;
            }
            
            // Verificar que el widget est√© listo
            if (typeof cloudinaryWidget.open === 'function') {
                // Abrir el widget
                cloudinaryWidget.open();
                console.log("‚úÖ Widget de Cloudinary abierto");
            } else {
                console.error("‚ùå Funci√≥n open no disponible en el widget");
                showStatus("Error: No se puede abrir el widget de Cloudinary", "danger");
            }
        }
        
        // ============================================
        // FUNCI√ìN PARA ELIMINAR COMPROBANTE
        // ============================================
        function removeReceipt() {
            currentReceiptUrl = '';
            document.getElementById('cloudinaryReceiptUrl').value = '';
            document.getElementById('receiptPreview').innerHTML = '';
            showStatus('üóëÔ∏è Comprobante eliminado', 'info');
        }
        
        // ============================================
        // FUNCI√ìN AUXILIAR PARA FORMATEAR BYTES
        // ============================================
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // ============================================
        // FUNCIONES DE PRODUCTOS
        // ============================================
        function loadProducts() {
            console.log("üì¶ Cargando productos desde Firebase...");
            showLoading('Cargando productos...');
            
            if (!firebaseDatabase) {
                showLoading(false);
                showStatus('Error: No hay conexi√≥n a la base de datos', 'danger');
                return;
            }
            
            const productsRef = firebaseDatabase.ref('products');
            
            productsRef.once('value')
                .then(function(snapshot) {
                    const productsData = snapshot.val();
                    allProducts = [];
                    
                    if (productsData) {
                        console.log("‚úÖ Productos encontrados:", Object.keys(productsData).length);
                        
                        Object.keys(productsData).forEach(function(key) {
                            const product = productsData[key];
                            
                            // Solo mostrar productos disponibles
                            if (product.available !== false) {
                                allProducts.push({
                                    id: key,
                                    ...product
                                });
                            }
                        });
                    } else {
                        console.log("‚ÑπÔ∏è No se encontraron productos");
                    }
                    
                    showLoading(false);
                    updateCategoryCounts();
                    filterProducts();
                    console.log("‚úÖ Productos cargados exitosamente:", allProducts.length);
                    
                })
                .catch(function(error) {
                    showLoading(false);
                    console.error('‚ùå Error al cargar productos:', error);
                    showStatus('Error al cargar productos: ' + error.message, 'danger');
                    
                    // Mostrar mensaje de error en la interfaz
                    document.getElementById('productsContainer').innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                            <h4>Error al cargar productos</h4>
                            <p>${error.message}</p>
                            <button class="btn btn-primary mt-3" onclick="loadProducts()">
                                <i class="fas fa-redo me-2"></i> Reintentar
                            </button>
                        </div>
                    `;
                });
        }
        
        function updateCategoryCounts() {
            const jewelsCount = allProducts.filter(function(product) {
                return product.category === 'Joyas';
            }).length;
            
            const clothingCount = allProducts.filter(function(product) {
                return product.category === 'Vestimenta';
            }).length;
            
            const perfumesCount = allProducts.filter(function(product) {
                return product.category === 'Perfumes';
            }).length;
            
            document.getElementById('jewelsCountBadge').innerHTML = 
                `<span class="badge bg-light text-dark">${jewelsCount} productos</span>`;
                
            document.getElementById('clothingCountBadge').innerHTML = 
                `<span class="badge bg-light text-dark">${clothingCount} productos</span>`;
                
            document.getElementById('perfumesCountBadge').innerHTML = 
                `<span class="badge bg-light text-dark">${perfumesCount} productos</span>`;
        }
        
        function filterProducts() {
            console.log("üîç Filtrando productos, categor√≠a:", currentCategory);
            let filteredProducts = [...allProducts];
            
            // Filtrar por categor√≠a
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(function(product) {
                    return product.category === currentCategory;
                });
            }
            
            // Filtrar por estado (oferta, nuevo)
            const statusFilter = document.getElementById('filterByStatus').value;
            if (statusFilter === 'sale') {
                filteredProducts = filteredProducts.filter(function(product) {
                    return product.onSale === true;
                });
            } else if (statusFilter === 'new') {
                filteredProducts = filteredProducts.filter(function(product) {
                    return product.new === true;
                });
            }
            
            // Ordenar
            const sortBy = document.getElementById('sortProducts').value;
            if (sortBy === 'price_asc') {
                filteredProducts.sort(function(a, b) {
                    const priceA = a.onSale && a.salePrice ? a.salePrice : a.price;
                    const priceB = b.onSale && b.salePrice ? b.salePrice : b.price;
                    return priceA - priceB;
                });
            } else if (sortBy === 'price_desc') {
                filteredProducts.sort(function(a, b) {
                    const priceA = a.onSale && a.salePrice ? a.salePrice : a.price;
                    const priceB = b.onSale && b.salePrice ? b.salePrice : b.price;
                    return priceB - priceA;
                });
            } else if (sortBy === 'name_asc') {
                filteredProducts.sort(function(a, b) {
                    return a.name.localeCompare(b.name);
                });
            } else {
                // M√°s recientes primero (por defecto)
                filteredProducts.sort(function(a, b) {
                    return (b.createdAt || 0) - (a.createdAt || 0);
                });
            }
            
            renderProducts(filteredProducts);
        }
        
        function renderProducts(products) {
            const container = document.getElementById('productsContainer');
            const noProductsMessage = document.getElementById('noProductsMessage');
            
            if (!products || products.length === 0) {
                container.innerHTML = '';
                noProductsMessage.style.display = 'block';
                return;
            }
            
            noProductsMessage.style.display = 'none';
            
            let html = '';
            
            products.forEach(function(product) {
                const mainImage = product.images && product.images.length > 0 ? 
                    product.images[0] : 'https://via.placeholder.com/300x200?text=Sin+imagen';
                
                const price = product.onSale && product.salePrice ? 
                    product.salePrice : (product.price || 0);
                
                const originalPrice = product.onSale && product.salePrice ? 
                    (product.price || 0) : null;
                
                // Verificar si el producto ya est√° en el carrito
                const inCart = cart.some(function(item) {
                    return item.id === product.id;
                });
                
                html += `
                    <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
                        <div class="card product-card h-100">
                            <div class="position-relative">
                                <img src="${mainImage}" class="card-img-top product-img" alt="${product.name || 'Producto'}" 
                                     onerror="this.src='https://via.placeholder.com/300x200?text=Error+imagen'">
                                <div class="position-absolute top-0 end-0 p-2">
                                    ${product.onSale ? '<span class="badge badge-sale me-1">Oferta</span>' : ''}
                                    ${product.new ? '<span class="badge badge-new">Nuevo</span>' : ''}
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${product.name || 'Producto sin nombre'}</h5>
                                <p class="card-text text-muted small flex-grow-1">${product.description ? 
                                    (product.description.substring(0, 80) + (product.description.length > 80 ? '...' : '')) : 
                                    'Sin descripci√≥n'}</p>
                                
                                <div class="mb-2">
                                    <span class="badge bg-light text-dark">${product.category || 'Sin categor√≠a'}</span>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <div>
                                        ${originalPrice ? 
                                            `<span class="product-price sale-price">$${parseFloat(price).toFixed(2)}</span>
                                             <small class="original-price ms-1">$${parseFloat(originalPrice).toFixed(2)}</small>` :
                                            `<span class="product-price">$${parseFloat(price).toFixed(2)}</span>`
                                        }
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between mt-3">
                                    <button class="btn btn-sm btn-outline-primary w-100 me-1" onclick="viewProductDetails('${product.id}')">
                                        <i class="fas fa-eye me-1"></i> Ver
                                    </button>
                                    <button class="btn btn-sm ${inCart ? 'btn-success' : 'btn-primary'} w-100 ms-1" 
                                            onclick="${inCart ? 'removeFromCart(\'' + product.id + '\')' : 'addToCart(\'' + product.id + '\')'}">
                                        <i class="fas ${inCart ? 'fa-check' : 'fa-cart-plus'} me-1"></i> 
                                        ${inCart ? 'En Carrito' : 'Agregar'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function showCategory(category) {
            console.log("üìÅ Mostrando categor√≠a:", category);
            currentCategory = category;
            
            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-link').forEach(function(link) {
                link.classList.remove('active');
            });
            
            // Activar el enlace correspondiente
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(function(link) {
                if (link.textContent.trim() === 'Inicio' && category === 'all') {
                    link.classList.add('active');
                } else if (link.textContent.trim() === category) {
                    link.classList.add('active');
                }
            });
            
            // Actualizar t√≠tulo de secci√≥n
            let sectionTitle = 'Productos Destacados';
            if (category === 'Joyas') sectionTitle = 'Joyas';
            else if (category === 'Vestimenta') sectionTitle = 'Vestimenta';
            else if (category === 'Perfumes') sectionTitle = 'Perfumes';
            else if (category === 'Accesorios') sectionTitle = 'Accesorios';
            
            document.getElementById('productsSectionTitle').textContent = sectionTitle;
            
            // Filtrar productos
            filterProducts();
            
            // Desplazar a la secci√≥n de productos
            document.getElementById('productsContainer').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        function showHome() {
            showCategory('all');
        }
        
        // ============================================
        // FUNCIONES DE CARRITO
        // ============================================
        function saveCartToStorage() {
            try {
                localStorage.setItem('cart', JSON.stringify(cart));
                console.log("üíæ Carrito guardado en localStorage:", cart.length, "productos");
            } catch (error) {
                console.error('‚ùå Error guardando carrito en localStorage:', error);
            }
        }
        
        function loadUserCartFromFirebase() {
            if (!currentUser || !firebaseDatabase) return;
            
            const userCartRef = firebaseDatabase.ref('userCarts/' + currentUser.uid);
            userCartRef.once('value').then(function(snapshot) {
                const savedCart = snapshot.val();
                if (savedCart && Array.isArray(savedCart)) {
                    cart = savedCart;
                    saveCartToStorage();
                    updateCartUI();
                    console.log("‚úÖ Carrito cargado desde Firebase");
                }
            }).catch(function(error) {
                console.error('‚ùå Error cargando carrito de Firebase:', error);
            });
        }
        
        function saveUserCartToFirebase() {
            if (!currentUser || !firebaseDatabase) return;
            
            const userCartRef = firebaseDatabase.ref('userCarts/' + currentUser.uid);
            userCartRef.set(cart).then(function() {
                console.log("‚úÖ Carrito guardado en Firebase");
            }).catch(function(error) {
                console.error('‚ùå Error al guardar carrito en Firebase:', error);
            });
        }
        
        function addToCart(productId) {
            const product = allProducts.find(function(p) {
                return p.id === productId;
            });
            
            if (!product) {
                showStatus('Producto no encontrado', 'warning');
                return;
            }
            
            // Verificar stock
            if (product.stock !== undefined && product.stock <= 0) {
                showStatus('Producto agotado', 'warning');
                return;
            }
            
            // Verificar si ya est√° en el carrito
            const existingItem = cart.find(function(item) {
                return item.id === productId;
            });
            
            if (existingItem) {
                // Verificar stock disponible
                if (product.stock !== undefined && existingItem.quantity >= product.stock) {
                    showStatus('Stock m√°ximo alcanzado para este producto', 'warning');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.onSale && product.salePrice ? product.salePrice : product.price,
                    image: product.images && product.images.length > 0 ? product.images[0] : '',
                    quantity: 1
                });
            }
            
            // Guardar carrito
            saveCartToStorage();
            saveUserCartToFirebase();
            
            // Actualizar UI
            updateCartUI();
            
            // Actualizar productos para cambiar bot√≥n
            filterProducts();
            
            showStatus('‚úÖ Producto agregado al carrito', 'success');
        }
        
        function removeFromCart(productId) {
            cart = cart.filter(function(item) {
                return item.id !== productId;
            });
            
            // Guardar carrito
            saveCartToStorage();
            saveUserCartToFirebase();
            
            // Actualizar UI
            updateCartUI();
            
            // Actualizar productos para cambiar bot√≥n
            filterProducts();
            
            showStatus('üóëÔ∏è Producto removido del carrito', 'info');
        }
        
        function updateCartQuantity(productId, quantity) {
            const item = cart.find(function(item) {
                return item.id === productId;
            });
            
            if (item) {
                // Encontrar el producto para verificar stock
                const product = allProducts.find(function(p) {
                    return p.id === productId;
                });
                
                if (product && product.stock !== undefined && quantity > product.stock) {
                    showStatus(`üì¶ Stock m√°ximo: ${product.stock} unidades`, 'warning');
                    return;
                }
                
                if (quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    item.quantity = quantity;
                    saveCartToStorage();
                    saveUserCartToFirebase();
                    updateCartUI();
                }
            }
        }
        
        function updateCartUI() {
            // Actualizar contador del carrito
            const totalItems = cart.reduce(function(sum, item) {
                return sum + item.quantity;
            }, 0);
            
            document.getElementById('cartCount').textContent = totalItems;
            
            // Actualizar carrito lateral si est√° abierto
            if (document.getElementById('cartSidebar').classList.contains('open')) {
                updateCartSidebar();
            }
        }
        
        function updateCartSidebar() {
            const container = document.getElementById('cartItemsContainer');
            const emptyMessage = document.getElementById('emptyCartMessage');
            const summary = document.getElementById('cartSummary');
            
            if (!cart || cart.length === 0) {
                container.innerHTML = `
                    <div id="emptyCartMessage" class="text-center py-5">
                        <i class="fas fa-shopping-cart fa-4x mb-4 text-muted"></i>
                        <h5 class="text-muted">Tu carrito est√° vac√≠o</h5>
                        <p class="text-muted">Agrega productos para comenzar a comprar</p>
                    </div>
                `;
                
                if (summary) summary.style.display = 'none';
                return;
            }
            
            if (emptyMessage) emptyMessage.style.display = 'none';
            
            let html = '';
            let subtotal = 0;
            
            cart.forEach(function(item) {
                const itemTotal = (item.price || 0) * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="cart-item mb-3">
                        <div class="d-flex">
                            <img src="${item.image || 'https://via.placeholder.com/70x70?text=Sin+imagen'}" 
                                 class="cart-item-img me-3" alt="${item.name || 'Producto'}"
                                 onerror="this.src='https://via.placeholder.com/70x70?text=Error'">
                            <div class="flex-grow-1">
                                <h6 class="mb-1">${item.name || 'Producto'}</h6>
                                <p class="mb-1 text-muted small">$${parseFloat(item.price || 0).toFixed(2)} c/u</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="input-group input-group-sm" style="width: 120px;">
                                        <button class="btn btn-outline-secondary" type="button" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">-</button>
                                        <input type="text" class="form-control text-center" value="${item.quantity}" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">+</button>
                                    </div>
                                    <span class="fw-bold">$${parseFloat(itemTotal).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Calcular totales
            const shipping = 5.00;
            const total = subtotal + shipping;
            
            if (summary) {
                document.getElementById('cartSubtotal').textContent = '$' + parseFloat(subtotal).toFixed(2);
                document.getElementById('cartShipping').textContent = '$' + shipping.toFixed(2);
                document.getElementById('cartTotal').textContent = '$' + parseFloat(total).toFixed(2);
                summary.style.display = 'block';
            }
        }
        
        function toggleCart() {
            updateCartSidebar();
            document.getElementById('cartSidebar').classList.toggle('open');
            document.getElementById('cartOverlay').classList.toggle('show');
        }
        
        function closeCart() {
            document.getElementById('cartSidebar').classList.remove('open');
            document.getElementById('cartOverlay').classList.remove('show');
        }
        
        // ============================================
        // FUNCIONES DE CHECKOUT
        // ============================================
        function goToCheckout() {
            if (cart.length === 0) {
                showStatus('Tu carrito est√° vac√≠o', 'warning');
                return;
            }
            
            // Si el usuario no est√° autenticado, mostrar modal de login
            if (!currentUser) {
                closeCart();
                showLoginModal();
                showStatus('Debes iniciar sesi√≥n para proceder al pago', 'info');
                return;
            }
            
            closeCart();
            showCheckoutPage();
        }
        
        function showCheckoutPage() {
            // Ocultar contenido principal
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('mainFooter').style.display = 'none';
            document.getElementById('adminPage').style.display = 'none';
            
            // Mostrar p√°gina de checkout
            document.getElementById('checkoutPage').style.display = 'block';
            
            // Actualizar resumen en checkout
            updateCheckoutSummary();
        }
        
        function returnToShop() {
            // Mostrar contenido principal
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('mainHeader').style.display = 'block';
            document.getElementById('mainFooter').style.display = 'block';
            
            // Ocultar otras p√°ginas
            document.getElementById('checkoutPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'none';
            
            // Cargar productos si es necesario
            if (allProducts.length === 0) {
                loadProducts();
            }
        }
        
        function updateCheckoutSummary() {
            const container = document.getElementById('checkoutItems');
            let subtotal = 0;
            
            let html = '';
            
            cart.forEach(function(item) {
                const itemTotal = (item.price || 0) * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="d-flex justify-content-between mb-2">
                        <div>
                            <span class="fw-bold">${item.name || 'Producto'}</span>
                            <br>
                            <small class="text-muted">${item.quantity} x $${parseFloat(item.price || 0).toFixed(2)}</small>
                        </div>
                        <span>$${parseFloat(itemTotal).toFixed(2)}</span>
                    </div>
                `;
            });
            
            if (container) {
                container.innerHTML = html;
                
                // Calcular totales
                const shipping = 5.00;
                const total = subtotal + shipping;
                
                document.getElementById('checkoutSubtotal').textContent = '$' + parseFloat(subtotal).toFixed(2);
                document.getElementById('checkoutShipping').textContent = '$' + shipping.toFixed(2);
                document.getElementById('checkoutTotal').textContent = '$' + parseFloat(total).toFixed(2);
            }
        }
        
        function selectPayment(method) {
            document.querySelectorAll('.payment-option').forEach(function(option) {
                option.classList.remove('active');
                const radio = option.querySelector('input[type="radio"]');
                if (radio) radio.checked = false;
            });
            
            event.currentTarget.classList.add('active');
            const radio = event.currentTarget.querySelector('input[type="radio"]');
            if (radio) radio.checked = true;
        }
        
        // ============================================
        // FUNCI√ìN DE PAGO COMPLETO CON CLOUDINARY
        // ============================================
        function completeOrder() {
            console.log("üí≥ Iniciando proceso de pago...");
            
            // Validar que el usuario est√© autenticado
            if (!currentUser) {
                showStatus('Debes iniciar sesi√≥n para completar el pedido', 'warning');
                showLoginModal();
                return;
            }
            
            // Validar que haya productos en el carrito
            if (cart.length === 0) {
                showStatus('Tu carrito est√° vac√≠o', 'warning');
                return;
            }
            
            // Validar comprobante de pago
            const receiptUrl = document.getElementById('cloudinaryReceiptUrl').value;
            if (!receiptUrl) {
                showStatus('Debes subir el comprobante de pago', 'warning');
                return;
            }
            
            // Deshabilitar bot√≥n para evitar doble clic
            const completeBtn = document.getElementById('completeOrderBtn');
            if (completeBtn) {
                completeBtn.disabled = true;
                completeBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Procesando...';
            }
            
            showLoading('Procesando tu pedido...');
            
            // Generar n√∫mero de pedido
            const orderNumber = 'ORD-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
            const timestamp = Date.now();
            
            // Extraer nombre del archivo de la URL de Cloudinary
            const urlParts = receiptUrl.split('/');
            const fileName = urlParts[urlParts.length - 1];
            
            console.log("üì§ Comprobante subido a Cloudinary:", receiptUrl);
            
            // Crear objeto de orden
            const orderData = {
                orderNumber: orderNumber,
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || currentUser.email.split('@')[0],
                items: cart,
                subtotal: parseFloat(document.getElementById('checkoutSubtotal').textContent.replace('$', '')) || 0,
                shipping: parseFloat(document.getElementById('checkoutShipping').textContent.replace('$', '')) || 5.00,
                total: parseFloat(document.getElementById('checkoutTotal').textContent.replace('$', '')) || 0,
                paymentMethod: 'transfer',
                receiptUrl: receiptUrl,
                receiptFileName: fileName,
                receiptCloudinaryInfo: {
                    uploadedAt: timestamp,
                    folder: "samples/depositos",
                    preset: "Depositos"
                },
                status: 'pendiente',
                createdAt: timestamp,
                updatedAt: timestamp
            };
            
            console.log("üìù Guardando orden en Firebase Database...");
            
            // Guardar en Firebase Database
            const ordersRef = firebaseDatabase.ref('orders');
            ordersRef.push(orderData)
                .then(function(newOrderRef) {
                    console.log("‚úÖ Orden guardada en Firebase Database con ID:", newOrderRef.key);
                    
                    // Tambi√©n guardar en ordersByUser para f√°cil acceso
                    const userOrderRef = firebaseDatabase.ref('ordersByUser/' + currentUser.uid + '/' + newOrderRef.key);
                    return userOrderRef.set({
                        orderNumber: orderNumber,
                        total: parseFloat(document.getElementById('checkoutTotal').textContent.replace('$', '')) || 0,
                        status: 'pendiente',
                        createdAt: timestamp,
                        receiptUrl: receiptUrl
                    });
                })
                .then(function() {
                    showLoading(false);
                    
                    // Vaciar carrito
                    cart = [];
                    localStorage.removeItem('cart');
                    saveUserCartToFirebase(); // Guardar carrito vac√≠o
                    updateCartUI();
                    
                    // Mostrar mensaje de √©xito
                    showStatus('‚úÖ ¬°Pedido realizado con √©xito! N√∫mero: ' + orderNumber, 'success');
                    
                    // Crear modal de confirmaci√≥n
                    createOrderConfirmationModal(orderNumber, receiptUrl);
                    
                    // Regresar a la tienda despu√©s de 3 segundos
                    setTimeout(function() {
                        returnToShop();
                        if (completeBtn) {
                            completeBtn.disabled = false;
                            completeBtn.innerHTML = '<i class="fas fa-check-circle me-2"></i> Confirmar Pedido';
                        }
                    }, 3000);
                })
                .catch(function(error) {
                    showLoading(false);
                    
                    if (completeBtn) {
                        completeBtn.disabled = false;
                        completeBtn.innerHTML = '<i class="fas fa-check-circle me-2"></i> Confirmar Pedido';
                    }
                    
                    console.error('‚ùå Error guardando orden:', error);
                    showStatus('Error al guardar el pedido: ' + error.message, 'danger');
                });
        }
        
        function createOrderConfirmationModal(orderNumber, receiptUrl) {
            const modalHtml = `
                <div class="modal fade" id="orderConfirmationModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title">¬°Pedido Confirmado!</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                                <h4>Pedido #${orderNumber}</h4>
                                <p class="mt-3">Tu pedido ha sido procesado exitosamente.</p>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="alert alert-info">
                                            <h6><i class="fas fa-info-circle me-2"></i>Informaci√≥n Importante</h6>
                                            <p class="mb-1"><strong>Comprobante subido a Cloudinary</strong></p>
                                            <p class="small mb-0">Tu comprobante ha sido guardado en la nube de forma segura.</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="alert alert-warning">
                                            <h6><i class="fas fa-clock me-2"></i>Pr√≥ximos Pasos</h6>
                                            <p class="mb-0">Nos pondremos en contacto contigo en 24-48 horas para confirmar el pago y enviar tu pedido.</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-secondary mt-3">
                                    <strong><i class="fas fa-save me-2"></i>Guarda tu n√∫mero de pedido:</strong> 
                                    <span class="fs-5 ms-2">${orderNumber}</span>
                                </div>
                                
                                <div class="mt-4">
                                    <a href="${receiptUrl}" target="_blank" class="btn btn-outline-primary me-2">
                                        <i class="fas fa-download me-2"></i> Ver Comprobante
                                    </a>
                                    <button type="button" class="btn btn-outline-success" onclick="printOrderConfirmation('${orderNumber}', '${receiptUrl}')">
                                        <i class="fas fa-print me-2"></i> Imprimir Confirmaci√≥n
                                    </button>
                                </div>
                            </div>
                            <div class="modal-footer justify-content-center">
                                <button type="button" class="btn btn-primary" onclick="bootstrap.Modal.getInstance(document.getElementById('orderConfirmationModal')).hide(); returnToShop();">
                                    <i class="fas fa-shopping-bag me-2"></i> Seguir Comprando
                                </button>
                                <button type="button" class="btn btn-outline-primary" onclick="viewMyOrders(); bootstrap.Modal.getInstance(document.getElementById('orderConfirmationModal')).hide();">
                                    <i class="fas fa-box me-2"></i> Ver Mis Pedidos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Agregar modal al DOM
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            
            // Mostrar modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('orderConfirmationModal'));
            confirmationModal.show();
            
            // Eliminar modal del DOM al cerrar
            document.getElementById('orderConfirmationModal').addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modalContainer);
            });
        }
        
        function printOrderConfirmation(orderNumber, receiptUrl) {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Confirmaci√≥n de Pedido #${orderNumber}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .logo { font-size: 24px; font-weight: bold; color: #333; }
                        .order-info { margin: 20px 0; }
                        .receipt-info { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
                        .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">LuxuryShop</div>
                        <h1>Confirmaci√≥n de Pedido</h1>
                    </div>
                    
                    <div class="order-info">
                        <h3>Pedido #${orderNumber}</h3>
                        <p><strong>Fecha:</strong> ${new Date().toLocaleDateString('es-ES', { 
                            day: '2-digit', 
                            month: '2-digit', 
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</p>
                        <p><strong>Estado:</strong> Pendiente de confirmaci√≥n</p>
                    </div>
                    
                    <div class="receipt-info">
                        <h4>Comprobante de Pago</h4>
                        <p><strong>URL del comprobante:</strong> ${receiptUrl}</p>
                        <p><strong>Almacenamiento:</strong> Cloudinary - Carpeta: samples/depositos</p>
                    </div>
                    
                    <div class="instructions">
                        <h4>Instrucciones:</h4>
                        <p>1. Guarda este documento como comprobante de tu pedido.</p>
                        <p>2. Te contactaremos en 24-48 horas para confirmar el pago.</p>
                        <p>3. Presenta este n√∫mero de pedido (#${orderNumber}) en cualquier consulta.</p>
                    </div>
                    
                    <div class="footer">
                        <p>LuxuryShop - Todos los derechos reservados ¬© ${new Date().getFullYear()}</p>
                        <p>Este es un comprobante de pedido electr√≥nico.</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ============================================
        // FUNCIONES DE AUTENTICACI√ìN
        // ============================================
        function showLoginModal() {
            // Mostrar formulario de login por defecto
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('authModalTitle').textContent = 'Iniciar Sesi√≥n';
            
            // Limpiar errores y campos
            clearAuthErrors();
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            // Mostrar modal
            const authModal = new bootstrap.Modal(document.getElementById('authModal'));
            authModal.show();
        }
        
        function showLoginForm() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('authModalTitle').textContent = 'Iniciar Sesi√≥n';
            clearAuthErrors();
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('authModalTitle').textContent = 'Registrarse';
            clearAuthErrors();
            
            // Limpiar campos
            document.getElementById('registerName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
        }
        
        function loginUser(email, password) {
            if (!firebaseAuth) {
                showStatus('Error: Firebase no est√° configurado', 'danger');
                return;
            }
            
            // Validar email
            if (!isValidEmail(email)) {
                showAuthError('loginEmailError', 'Ingresa un correo electr√≥nico v√°lido');
                return;
            }
            
            if (!password || password.length < 6) {
                showAuthError('loginPasswordError', 'La contrase√±a debe tener al menos 6 caracteres');
                return;
            }
            
            clearAuthErrors();
            showLoading('Iniciando sesi√≥n...');
            
            firebaseAuth.signInWithEmailAndPassword(email, password)
                .then(function(userCredential) {
                    showLoading(false);
                    
                    // Cerrar modal
                    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                    if (authModal) authModal.hide();
                    
                    showStatus('‚úÖ Sesi√≥n iniciada correctamente', 'success');
                    
                    // Si hab√≠a un carrito en localStorage, migrarlo a Firebase
                    if (cart.length > 0) {
                        saveUserCartToFirebase();
                    }
                })
                .catch(function(error) {
                    showLoading(false);
                    console.error('‚ùå Login error:', error);
                    
                    let errorMessage = 'Error al iniciar sesi√≥n';
                    
                    switch(error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'Correo electr√≥nico inv√°lido';
                            showAuthError('loginEmailError', errorMessage);
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'Esta cuenta ha sido deshabilitada';
                            showGeneralAuthError('loginGeneralError', errorMessage);
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'No existe una cuenta con este correo';
                            showAuthError('loginEmailError', errorMessage);
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Contrase√±a incorrecta';
                            showAuthError('loginPasswordError', errorMessage);
                            break;
                        case 'auth/too-many-requests':
                            errorMessage = 'Demasiados intentos. Intenta m√°s tarde';
                            showGeneralAuthError('loginGeneralError', errorMessage);
                            break;
                        default:
                            errorMessage = error.message || 'Error desconocido';
                            showGeneralAuthError('loginGeneralError', errorMessage);
                    }
                });
        }
        
        function registerUser(name, email, password) {
            if (!firebaseAuth || !firebaseDatabase) {
                showStatus('Error: Firebase no est√° configurado', 'danger');
                return;
            }
            
            showLoading('Registrando usuario...');
            
            firebaseAuth.createUserWithEmailAndPassword(email, password)
                .then(function(userCredential) {
                    // Guardar informaci√≥n adicional del usuario
                    const user = userCredential.user;
                    
                    const userData = {
                        name: name,
                        email: user.email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    return firebaseDatabase.ref('users/' + user.uid).set(userData);
                })
                .then(function() {
                    showLoading(false);
                    
                    // Cerrar modal
                    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                    if (authModal) authModal.hide();
                    
                    showStatus('‚úÖ Usuario registrado correctamente', 'success');
                    
                    // Guardar carrito en Firebase para el nuevo usuario
                    if (cart.length > 0) {
                        saveUserCartToFirebase();
                    }
                })
                .catch(function(error) {
                    showLoading(false);
                    console.error('‚ùå Register error:', error);
                    
                    let errorMessage = 'Error al registrar usuario';
                    
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'Este correo ya est√° registrado';
                            showAuthError('registerEmailError', errorMessage);
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Correo electr√≥nico inv√°lido';
                            showAuthError('registerEmailError', errorMessage);
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage = 'El registro con email/contrase√±a no est√° habilitado';
                            showGeneralAuthError('registerGeneralError', errorMessage);
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'La contrase√±a es demasiado d√©bil';
                            showAuthError('registerPasswordError', errorMessage);
                            break;
                        default:
                            errorMessage = error.message || 'Error desconocido';
                            showGeneralAuthError('registerGeneralError', errorMessage);
                    }
                });
        }
        
        function logout() {
            if (!firebaseAuth) return;
            
            firebaseAuth.signOut()
                .then(function() {
                    cart = [];
                    saveCartToStorage();
                    updateCartUI();
                    showStatus('‚úÖ Sesi√≥n cerrada correctamente', 'success');
                })
                .catch(function(error) {
                    showStatus('‚ùå Error al cerrar sesi√≥n: ' + error.message, 'danger');
                });
        }
        
        function updateUserUI() {
            const userSection = document.getElementById('userAuthSection');
            if (!userSection) return;
            
            if (currentUser) {
                const displayName = currentUser.email ? currentUser.email.split('@')[0] : 'Usuario';
                
                // Verificar si es administrador
                const isAdmin = currentUser.email === 'admin@luxuryshop.com' || currentUser.email === 'admin@admin.com';
                
                userSection.innerHTML = `
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> ${displayName}
                        </button>
                        <ul class="dropdown-menu">
                            ${isAdmin ? `
                                <li><a class="dropdown-item" href="#" onclick="showAdminPanel()"><i class="fas fa-cog me-2"></i> Panel Admin</a></li>
                                <li><hr class="dropdown-divider"></li>
                            ` : ''}
                            <li><a class="dropdown-item" href="#" onclick="viewMyOrders()"><i class="fas fa-box me-2"></i> Mis Pedidos</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesi√≥n</a></li>
                        </ul>
                    </div>
                `;
            } else {
                userSection.innerHTML = `
                    <button class="btn btn-outline-primary" id="loginBtn" onclick="showLoginModal()">
                        <i class="fas fa-user me-1"></i> Iniciar Sesi√≥n
                    </button>
                `;
            }
        }
        
        function viewMyOrders() {
            if (!currentUser) {
                showStatus('Debes iniciar sesi√≥n para ver tus pedidos', 'warning');
                showLoginModal();
                return;
            }
            
            showLoading('Cargando tus pedidos...');
            
            const ordersRef = firebaseDatabase.ref('orders');
            ordersRef.orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then(function(snapshot) {
                    showLoading(false);
                    const ordersData = snapshot.val();
                    
                    if (!ordersData) {
                        alert('No tienes pedidos realizados.');
                        return;
                    }
                    
                    let ordersHtml = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Pedido</th><th>Fecha</th><th>Total</th><th>Estado</th><th>Acciones</th></tr></thead><tbody>';
                    
                    Object.keys(ordersData).forEach(function(key) {
                        const order = ordersData[key];
                        const date = order.createdAt ? new Date(order.createdAt).toLocaleDateString() : 'Sin fecha';
                        
                        let statusClass = 'bg-warning';
                        if (order.status === 'completado') statusClass = 'bg-success';
                        else if (order.status === 'enviado') statusClass = 'bg-primary';
                        else if (order.status === 'cancelado') statusClass = 'bg-danger';
                        
                        ordersHtml += `
                            <tr>
                                <td>${order.orderNumber || 'N/A'}</td>
                                <td>${date}</td>
                                <td>$${parseFloat(order.total || 0).toFixed(2)}</td>
                                <td><span class="badge ${statusClass}">${order.status || 'pendiente'}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewOrderDetailsCustomer('${key}')">
                                        <i class="fas fa-eye"></i> Detalles
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    ordersHtml += '</tbody></table></div>';
                    
                    // Crear modal para mostrar pedidos
                    const modalHtml = `
                        <div class="modal fade" id="customerOrdersModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Mis Pedidos</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        ${ordersHtml}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Agregar modal al DOM
                    const modalContainer = document.createElement('div');
                    modalContainer.innerHTML = modalHtml;
                    document.body.appendChild(modalContainer);
                    
                    // Mostrar modal
                    const ordersModal = new bootstrap.Modal(document.getElementById('customerOrdersModal'));
                    ordersModal.show();
                    
                    // Eliminar modal del DOM al cerrar
                    document.getElementById('customerOrdersModal').addEventListener('hidden.bs.modal', function() {
                        document.body.removeChild(modalContainer);
                    });
                })
                .catch(function(error) {
                    showLoading(false);
                    console.error('‚ùå Error cargando pedidos:', error);
                    showStatus('Error al cargar pedidos: ' + error.message, 'danger');
                });
        }
        
        function viewOrderDetailsCustomer(orderId) {
            const orderRef = firebaseDatabase.ref('orders/' + orderId);
            orderRef.once('value')
                .then(function(snapshot) {
                    const order = snapshot.val();
                    if (!order) return;
                    
                    // Crear modal para ver detalles del pedido (versi√≥n cliente)
                    const modalHtml = `
                        <div class="modal fade" id="orderDetailsCustomerModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Detalles del Pedido #${order.orderNumber}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Informaci√≥n del Pedido</h6>
                                                <p><strong>N√∫mero:</strong> ${order.orderNumber || 'N/A'}</p>
                                                <p><strong>Fecha:</strong> ${order.createdAt ? new Date(order.createdAt).toLocaleDateString('es-ES', {
                                                    day: '2-digit',
                                                    month: '2-digit',
                                                    year: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                }) : 'Sin fecha'}</p>
                                                <p><strong>Estado:</strong> <span class="badge ${getStatusClass(order.status)}">${order.status || 'pendiente'}</span></p>
                                                
                                                <h6 class="mt-4">Informaci√≥n de Pago</h6>
                                                <p><strong>M√©todo:</strong> ${order.paymentMethod || 'Transferencia'}</p>
                                                <p><strong>Total:</strong> $${parseFloat(order.total || 0).toFixed(2)}</p>
                                                <p><strong>Subtotal:</strong> $${parseFloat(order.subtotal || 0).toFixed(2)}</p>
                                                <p><strong>Env√≠o:</strong> $${parseFloat(order.shipping || 0).toFixed(2)}</p>
                                                
                                                <h6 class="mt-4">Comprobante</h6>
                                                ${order.receiptUrl ? 
                                                    `<div class="alert alert-info">
                                                        <p class="mb-1"><strong>Comprobante subido a Cloudinary</strong></p>
                                                        <a href="${order.receiptUrl}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                                                            <i class="fas fa-download me-1"></i> Ver Comprobante
                                                        </a>
                                                    </div>` : 
                                                    '<p class="text-muted">No hay comprobante</p>'
                                                }
                                            </div>
                                            <div class="col-md-6">
                                                <h6>Productos</h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Producto</th>
                                                                <th>Cantidad</th>
                                                                <th>Precio</th>
                                                                <th>Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${order.items ? order.items.map(function(item) {
                                                                return `
                                                                    <tr>
                                                                        <td>${item.name || 'Producto'}</td>
                                                                        <td>${item.quantity || 1}</td>
                                                                        <td>$${parseFloat(item.price || 0).toFixed(2)}</td>
                                                                        <td>$${parseFloat((item.price || 0) * (item.quantity || 1)).toFixed(2)}</td>
                                                                    </tr>
                                                                `;
                                                            }).join('') : ''}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Agregar modal al DOM
                    const modalContainer = document.createElement('div');
                    modalContainer.innerHTML = modalHtml;
                    document.body.appendChild(modalContainer);
                    
                    // Mostrar modal
                    const detailsModal = new bootstrap.Modal(document.getElementById('orderDetailsCustomerModal'));
                    detailsModal.show();
                    
                    // Eliminar modal del DOM al cerrar
                    document.getElementById('orderDetailsCustomerModal').addEventListener('hidden.bs.modal', function() {
                        document.body.removeChild(modalContainer);
                    });
                })
                .catch(function(error) {
                    console.error('‚ùå Error cargando detalles del pedido:', error);
                    showStatus('Error al cargar detalles: ' + error.message, 'danger');
                });
        }
        
        // ============================================
        // FUNCIONES DEL PANEL DE ADMINISTRACI√ìN
        // ============================================
        function showAdminPanel() {
            // Verificar si el usuario es admin
            if (!currentUser || !(currentUser.email === 'admin@luxuryshop.com' || currentUser.email === 'admin@admin.com')) {
                showStatus('No tienes permisos de administrador', 'warning');
                return;
            }
            
            // Ocultar contenido principal
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('mainFooter').style.display = 'none';
            document.getElementById('checkoutPage').style.display = 'none';
            
            // Mostrar panel de administraci√≥n
            document.getElementById('adminPage').style.display = 'block';
            
            // Cargar pedidos
            loadAdminOrders();
        }
        
        function loadAdminOrders() {
            showLoading('Cargando pedidos...');
            
            const ordersRef = firebaseDatabase.ref('orders');
            ordersRef.orderByChild('createdAt').once('value')
                .then(function(snapshot) {
                    showLoading(false);
                    const ordersData = snapshot.val();
                    allOrders = [];
                    
                    if (ordersData) {
                        Object.keys(ordersData).forEach(function(key) {
                            allOrders.push({
                                id: key,
                                ...ordersData[key]
                            });
                        });
                    }
                    
                    // Ordenar por fecha (m√°s reciente primero)
                    allOrders.sort(function(a, b) {
                        return (b.createdAt || 0) - (a.createdAt || 0);
                    });
                    
                    renderAdminOrders(allOrders);
                    updateAdminStats(allOrders);
                })
                .catch(function(error) {
                    showLoading(false);
                    console.error('‚ùå Error cargando pedidos admin:', error);
                    showStatus('Error al cargar pedidos: ' + error.message, 'danger');
                });
        }
        
        function renderAdminOrders(orders) {
            const ordersTable = document.getElementById('adminOrdersTable');
            
            if (!orders || orders.length === 0) {
                ordersTable.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">No hay pedidos registrados</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            orders.forEach(function(order) {
                const date = order.createdAt ? new Date(order.createdAt).toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'Sin fecha';
                
                html += `
                    <tr>
                        <td><strong>${order.orderNumber || 'N/A'}</strong></td>
                        <td>
                            <div>${order.userName || order.userEmail || 'Cliente'}</div>
                            <small class="text-muted">${order.userEmail || ''}</small>
                        </td>
                        <td>${date}</td>
                        <td>$${parseFloat(order.total || 0).toFixed(2)}</td>
                        <td>
                            <span class="badge ${getStatusClass(order.status)}" id="statusBadge_${order.id}">${order.status || 'pendiente'}</span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewOrderDetailsAdmin('${order.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <div class="dropdown d-inline-block">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="updateOrderStatus('${order.id}', 'confirmado')"><i class="fas fa-check-circle me-2 text-info"></i>Marcar como Confirmado</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="updateOrderStatus('${order.id}', 'enviado')"><i class="fas fa-shipping-fast me-2 text-primary"></i>Marcar como Enviado</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="updateOrderStatus('${order.id}', 'completado')"><i class="fas fa-check-double me-2 text-success"></i>Marcar como Completado</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="updateOrderStatus('${order.id}', 'cancelado')"><i class="fas fa-times-circle me-2 text-danger"></i>Cancelar Pedido</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            ordersTable.innerHTML = html;
        }
        
        function updateAdminStats(orders) {
            if (!orders || orders.length === 0) {
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('pendingOrders').textContent = '0';
                document.getElementById('completedOrders').textContent = '0';
                return;
            }
            
            const totalOrders = orders.length;
            const pendingOrders = orders.filter(function(order) {
                return order.status === 'pendiente';
            }).length;
            
            const completedOrders = orders.filter(function(order) {
                return order.status === 'completado';
            }).length;
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('completedOrders').textContent = completedOrders;
        }
        
        function viewOrderDetailsAdmin(orderId) {
            const orderRef = firebaseDatabase.ref('orders/' + orderId);
            orderRef.once('value')
                .then(function(snapshot) {
                    const order = snapshot.val();
                    if (!order) return;
                    
                    // Crear modal para ver detalles del pedido (versi√≥n admin)
                    const modalHtml = `
                        <div class="modal fade" id="orderDetailsAdminModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Pedido #${order.orderNumber} (Admin)</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Informaci√≥n del Cliente</h6>
                                                <p><strong>Nombre:</strong> ${order.userName || 'No especificado'}</p>
                                                <p><strong>Email:</strong> ${order.userEmail || 'No especificado'}</p>
                                                <p><strong>ID Usuario:</strong> ${order.userId || 'N/A'}</p>
                                                
                                                <h6 class="mt-4">Informaci√≥n de Pago</h6>
                                                <p><strong>M√©todo:</strong> ${order.paymentMethod || 'Transferencia'}</p>
                                                <p><strong>Total:</strong> $${parseFloat(order.total || 0).toFixed(2)}</p>
                                                <p><strong>Subtotal:</strong> $${parseFloat(order.subtotal || 0).toFixed(2)}</p>
                                                <p><strong>Env√≠o:</strong> $${parseFloat(order.shipping || 0).toFixed(2)}</p>
                                                
                                                <h6 class="mt-4">Informaci√≥n Cloudinary</h6>
                                                <div class="border rounded p-3 bg-light">
                                                    ${order.receiptUrl ? 
                                                        `<p class="mb-1"><strong>URL:</strong> <a href="${order.receiptUrl}" target="_blank">Ver comprobante</a></p>` : 
                                                        '<p class="mb-1 text-muted">No hay comprobante</p>'
                                                    }
                                                    ${order.receiptFileName ? `<p class="mb-1"><strong>Archivo:</strong> ${order.receiptFileName}</p>` : ''}
                                                    ${order.receiptCloudinaryInfo ? `
                                                        <p class="mb-1"><strong>Carpeta:</strong> ${order.receiptCloudinaryInfo.folder || 'samples/depositos'}</p>
                                                        <p class="mb-1"><strong>Preset:</strong> ${order.receiptCloudinaryInfo.preset || 'Depositos'}</p>
                                                    ` : ''}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>Productos</h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Producto</th>
                                                                <th>Cantidad</th>
                                                                <th>Precio</th>
                                                                <th>Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${order.items ? order.items.map(function(item) {
                                                                return `
                                                                    <tr>
                                                                        <td>${item.name || 'Producto'}</td>
                                                                        <td>${item.quantity || 1}</td>
                                                                        <td>$${parseFloat(item.price || 0).toFixed(2)}</td>
                                                                        <td>$${parseFloat((item.price || 0) * (item.quantity || 1)).toFixed(2)}</td>
                                                                    </tr>
                                                                `;
                                                            }).join('') : ''}
                                                        </tbody>
                                                    </table>
                                                </div>
                                                
                                                <h6 class="mt-4">Estado del Pedido</h6>
                                                <div class="mb-3">
                                                    <span class="badge ${getStatusClass(order.status)}">${order.status || 'pendiente'}</span>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Actualizar Estado</label>
                                                    <select class="form-select" id="updateStatusSelect">
                                                        <option value="pendiente" ${order.status === 'pendiente' ? 'selected' : ''}>Pendiente</option>
                                                        <option value="confirmado" ${order.status === 'confirmado' ? 'selected' : ''}>Confirmado</option>
                                                        <option value="enviado" ${order.status === 'enviado' ? 'selected' : ''}>Enviado</option>
                                                        <option value="completado" ${order.status === 'completado' ? 'selected' : ''}>Completado</option>
                                                        <option value="cancelado" ${order.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-primary w-100" onclick="updateOrderStatus('${orderId}', document.getElementById('updateStatusSelect').value); bootstrap.Modal.getInstance(document.getElementById('orderDetailsAdminModal')).hide();">
                                                    <i class="fas fa-save me-2"></i> Actualizar Estado
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Agregar modal al DOM
                    const modalContainer = document.createElement('div');
                    modalContainer.innerHTML = modalHtml;
                    document.body.appendChild(modalContainer);
                    
                    // Mostrar modal
                    const detailsModal = new bootstrap.Modal(document.getElementById('orderDetailsAdminModal'));
                    detailsModal.show();
                    
                    // Eliminar modal del DOM al cerrar
                    document.getElementById('orderDetailsAdminModal').addEventListener('hidden.bs.modal', function() {
                        document.body.removeChild(modalContainer);
                    });
                })
                .catch(function(error) {
                    console.error('‚ùå Error cargando detalles del pedido:', error);
                    showStatus('Error al cargar detalles: ' + error.message, 'danger');
                });
        }
        
        function updateOrderStatus(orderId, newStatus) {
            if (!confirm(`¬øEst√°s seguro de cambiar el estado a "${newStatus}"?`)) {
                return;
            }
            
            showLoading('Actualizando estado...');
            
            const orderRef = firebaseDatabase.ref('orders/' + orderId);
            orderRef.update({
                status: newStatus,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            })
            .then(function() {
                showLoading(false);
                showStatus('‚úÖ Estado actualizado correctamente', 'success');
                
                // Actualizar badge en la tabla
                const statusBadge = document.getElementById('statusBadge_' + orderId);
                if (statusBadge) {
                    statusBadge.textContent = newStatus;
                    statusBadge.className = 'badge ' + getStatusClass(newStatus);
                }
                
                // Recargar estad√≠sticas
                loadAdminOrders();
            })
            .catch(function(error) {
                showLoading(false);
                console.error('‚ùå Error actualizando estado:', error);
                showStatus('Error al actualizar estado: ' + error.message, 'danger');
            });
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'pendiente':
                    return 'bg-warning';
                case 'confirmado':
                    return 'bg-info';
                case 'enviado':
                    return 'bg-primary';
                case 'completado':
                    return 'bg-success';
                case 'cancelado':
                    return 'bg-danger';
                default:
                    return 'bg-secondary';
            }
        }
        
        function filterAdminOrders() {
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFrom = document.getElementById('dateFromFilter').value;
            const dateTo = document.getElementById('dateToFilter').value;
            
            let filteredOrders = [...allOrders];
            
            // Filtrar por estado
            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(function(order) {
                    return order.status === statusFilter;
                });
            }
            
            // Filtrar por fecha
            if (dateFrom) {
                const fromDate = new Date(dateFrom).getTime();
                filteredOrders = filteredOrders.filter(function(order) {
                    return order.createdAt >= fromDate;
                });
            }
            
            if (dateTo) {
                const toDate = new Date(dateTo + 'T23:59:59').getTime();
                filteredOrders = filteredOrders.filter(function(order) {
                    return order.createdAt <= toDate;
                });
            }
            
            renderAdminOrders(filteredOrders);
        }
        
        function clearFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('dateFromFilter').value = '';
            document.getElementById('dateToFilter').value = '';
            loadAdminOrders();
        }
        
        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        function showAuthError(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.style.display = 'block';
            }
        }
        
        function showGeneralAuthError(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.style.display = 'block';
            }
        }
        
        function clearAuthErrors() {
            // Limpiar todos los mensajes de error
            document.querySelectorAll('.auth-error').forEach(function(el) {
                el.textContent = '';
                el.style.display = 'none';
            });
            
            // Limpiar errores generales
            const loginError = document.getElementById('loginGeneralError');
            const registerError = document.getElementById('registerGeneralError');
            if (loginError) loginError.style.display = 'none';
            if (registerError) registerError.style.display = 'none';
        }
        
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function showLoading(message = false) {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            
            if (overlay && text) {
                if (message) {
                    overlay.style.display = 'flex';
                    text.textContent = message;
                } else {
                    overlay.style.display = 'none';
                }
            }
        }
        
        function showStatus(message, type = 'success') {
            const alert = document.getElementById('statusAlert');
            const messageSpan = document.getElementById('statusMessage');
            
            if (alert && messageSpan) {
                alert.className = `alert alert-${type} alert-dismissible fade show status-alert`;
                messageSpan.textContent = message;
                alert.style.display = 'block';
                
                // Auto-ocultar despu√©s de 5 segundos
                setTimeout(function() {
                    if (alert.style.display === 'block') {
                        hideStatus();
                    }
                }, 5000);
            }
        }
        
        function hideStatus() {
            const alert = document.getElementById('statusAlert');
            if (alert) alert.style.display = 'none';
        }
        
        function viewProductDetails(productId) {
            const product = allProducts.find(function(p) {
                return p.id === productId;
            });
            
            if (!product) {
                showStatus('Producto no encontrado', 'warning');
                return;
            }
            
            const mainImage = product.images && product.images.length > 0 ? 
                product.images[0] : 'https://via.placeholder.com/400x400?text=Sin+imagen';
            
            const price = product.onSale && product.salePrice ? 
                product.salePrice : (product.price || 0);
            
            const originalPrice = product.onSale && product.salePrice ? 
                (product.price || 0) : null;
            
            // Crear modal para detalles del producto
            const modalHtml = `
                <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${product.name || 'Producto'}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <img src="${mainImage}" class="img-fluid rounded" alt="${product.name || 'Producto'}"
                                             onerror="this.src='https://via.placeholder.com/400x400?text=Error+imagen'">
                                    </div>
                                    <div class="col-md-6">
                                        <h4 class="mb-3">${product.name || 'Producto'}</h4>
                                        <p class="text-muted">C√≥digo: ${product.code || 'N/A'}</p>
                                        
                                        <div class="mb-3">
                                            <span class="badge bg-light text-dark">${product.category || 'Sin categor√≠a'}</span>
                                            ${product.subcategory ? `<span class="badge bg-light text-dark ms-1">${product.subcategory}</span>` : ''}
                                            ${product.onSale ? '<span class="badge badge-sale ms-1">Oferta</span>' : ''}
                                            ${product.new ? '<span class="badge badge-new ms-1">Nuevo</span>' : ''}
                                        </div>
                                        
                                        <div class="mb-4">
                                            ${originalPrice ? 
                                                `<h3 class="sale-price">$${parseFloat(price).toFixed(2)}</h3>
                                                 <p class="text-muted"><s>$${parseFloat(originalPrice).toFixed(2)}</s></p>` :
                                                `<h3>$${parseFloat(price).toFixed(2)}</h3>`
                                            }
                                        </div>
                                        
                                        <div class="mb-4">
                                            <h6>Descripci√≥n</h6>
                                            <p>${product.description || 'Sin descripci√≥n'}</p>
                                        </div>
                                        
                                        <div class="mb-4">
                                            ${product.brand ? `<p><strong>Marca:</strong> ${product.brand}</p>` : ''}
                                            ${product.material ? `<p><strong>Material:</strong> ${product.material}</p>` : ''}
                                            ${product.color ? `<p><strong>Color:</strong> ${product.color}</p>` : ''}
                                            ${product.size ? `<p><strong>Tama√±o:</strong> ${product.size}</p>` : ''}
                                        </div>
                                        
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <span class="text-muted">Stock disponible: ${product.stock || 0}</span>
                                            </div>
                                            <button class="btn btn-primary" onclick="addToCart('${product.id}'); bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();">
                                                <i class="fas fa-cart-plus me-2"></i> Agregar al Carrito
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Agregar modal al DOM
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            
            // Mostrar modal
            const productModal = new bootstrap.Modal(document.getElementById('productModal'));
            productModal.show();
            
            // Eliminar modal del DOM al cerrar
            document.getElementById('productModal').addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modalContainer);
            });
        }
        
        // ============================================
        // INICIALIZACI√ìN FINAL
        // ============================================
        console.log("‚úÖ Aplicaci√≥n configurada correctamente");
        console.log("üî• Firebase Database: Activo");
        console.log("‚òÅÔ∏è Cloudinary: Configurado correctamente con tus datos");
        console.log("üìÅ Im√°genes se guardar√°n en: samples/depositos");
        console.log("üì± Tienda online lista para usar");
        console.log("üëë Panel de administraci√≥n disponible para admin@luxuryshop.com");
        console.log("üí≥ Sistema de pago con Cloudinary funcionando correctamente");
        console.log("üéØ Widget de Cloudinary listo para subir comprobantes");
        
        // Verificar que Cloudinary est√© cargado
        if (typeof cloudinary !== 'undefined') {
            console.log("‚úÖ Cloudinary SDK cargado correctamente");
        } else {
            console.error("‚ùå Cloudinary SDK no se carg√≥ correctamente");
            showStatus("Advertencia: Cloudinary no se carg√≥ correctamente", "warning");
        }
    </script>
</body>
</html>
